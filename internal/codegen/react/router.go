package react

import (
	"fmt"
	"strings"

	"github.com/barun-bash/human/internal/ir"
)

// generateApp produces App.tsx with React Router setup.
func generateApp(app *ir.Application) string {
	var b strings.Builder

	b.WriteString("// Generated by Human compiler — do not edit\n\n")
	b.WriteString("import React from 'react';\n")
	b.WriteString("import { BrowserRouter, Routes, Route } from 'react-router-dom';\n")

	// Import each page
	for _, page := range app.Pages {
		name := page.Name + "Page"
		fmt.Fprintf(&b, "import %s from './pages/%s';\n", name, name)
	}

	b.WriteString("\n")
	b.WriteString("export default function App() {\n")
	b.WriteString("  return (\n")
	b.WriteString("    <BrowserRouter>\n")
	b.WriteString("      <Routes>\n")

	for _, page := range app.Pages {
		name := page.Name + "Page"
		path := routePath(page.Name)
		fmt.Fprintf(&b, "        <Route path=\"%s\" element={<%s />} />\n", path, name)
	}

	b.WriteString("      </Routes>\n")
	b.WriteString("    </BrowserRouter>\n")
	b.WriteString("  );\n")
	b.WriteString("}\n")

	return b.String()
}

// routePath converts a page name to a route path.
// "Home" → "/", others → "/<kebab-case>"
func routePath(name string) string {
	if strings.ToLower(name) == "home" {
		return "/"
	}
	return "/" + toKebabCase(name)
}
