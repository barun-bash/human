app BlogPlatform is a web application

# ─────────────────────────────────────────────────────────────
── theme ──
# ─────────────────────────────────────────────────────────────

theme:
  primary color is #2D3436
  secondary color is #0984E3
  accent color is #6C5CE7
  font is Merriweather for body and Source Sans Pro for headings
  border radius is subtle on all elements
  dark mode is supported and toggles from the header
  spacing is comfortable

# ─────────────────────────────────────────────────────────────
── frontend ──
# ─────────────────────────────────────────────────────────────

page Home:
  show a hero section with the blog name and tagline
  show a list of published posts sorted by publish date descending
  each post shows its title, excerpt, author name, and publish date
  there is a search bar that filters posts by title or content
  there is a sidebar with categories and popular tags
  clicking a post navigates to PostDetail
  if no posts match, show "No posts found matching your search"
  while loading, show a skeleton screen
  scrolling to bottom loads more posts

page PostDetail:
  show the post title in large heading
  show the author name and avatar with publish date
  show the post content as rich text
  show tags as clickable badges below the content
  show a "Back to Home" link at the top
  if user is logged in, show a comment form below the post
  show a list of comments sorted by date
  each comment shows the author name, content, and relative date
  if a comment has replies, show them nested below the parent
  clicking "Reply" opens a reply form under the comment
  if post does not exist, show "Post not found"

page Dashboard:
  show a greeting with the author's name
  show a summary card with total posts, published posts, and draft posts
  show a list of the author's posts sorted by updated date
  each post shows its title, status, and view count
  there is a dropdown to filter by status
  clicking a post navigates to Editor
  there is a button to create a new post
  if no posts exist, show "Write your first post!"

page Editor:
  show a form to create or edit a Post
  there is a text input for title
  there is a rich text editor for content
  there is a text input for excerpt
  there is a dropdown to select a Category
  there is a tag selector to add or remove Tags
  there is a file upload for cover image
  there is a toggle for published status
  clicking "Save Draft" saves the post with draft status
  clicking "Publish" saves the post with published status
  clicking "Submit for Review" saves with review status
  if the save succeeds, show "Post saved successfully"
  if there is an error, show the error message

component PostCard:
  accepts post as Post
  show the cover image at the top
  show the post title in bold
  show the excerpt truncated to 150 characters
  show the author name and publish date
  show the category as a small badge
  clicking the card triggers on_click

component CommentThread:
  accepts comment as Comment
  show the author name and avatar
  show the comment content
  show the date in relative format like "2 hours ago"
  if comment has replies, show nested comments indented
  there is a "Reply" button that triggers on_reply

# ─────────────────────────────────────────────────────────────
── backend ──
# ─────────────────────────────────────────────────────────────

data User:
  has a name which is text
  has an email which is unique email
  has a password which is encrypted text
  has a role which is either "reader" or "author" or "admin"
  has an optional bio which is text
  has an optional avatar which is image
  has a created datetime
  has many Post
  has many Comment

data Category:
  has a name which is unique text
  has an optional description which is text
  has a slug which is unique text
  has many Post

data Post:
  belongs to a User
  belongs to a Category
  has a title which is text
  has a slug which is unique text
  has a content which is text
  has an optional excerpt which is text
  has an optional cover_image which is image
  has a status which is either "draft" or "review" or "published"
  has a view_count which is number
  has an optional published_at which is datetime
  has a created datetime
  has many Comment
  has many Tag through PostTag

data Comment:
  belongs to a User
  belongs to a Post
  has a content which is text
  has an optional parent_comment which is number
  has a created datetime

data Tag:
  has a name which is unique text
  has a slug which is unique text
  has many Post through PostTag

data PostTag:
  belongs to a Post
  belongs to a Tag

api SignUp:
  accepts name, email, and password
  check that name is not empty
  check that email is a valid email
  check that password is at least 8 characters
  check that email is not already taken
  create a User with the given fields
  assign "reader" role
  respond with the created user and auth token

api Login:
  accepts email and password
  check that email is not empty
  check that password is not empty
  fetch the user by email
  if user does not exist, respond with "invalid credentials"
  check that password matches the stored hash
  if password does not match, respond with "invalid credentials"
  respond with the user and auth token

api CreatePost:
  requires authentication
  accepts title, content, excerpt, category_id, tags, and cover_image
  check that title is not empty
  check that title is less than 200 characters
  check that content is not empty
  create a Post with the given fields and current user as author
  generate slug from title
  set status to "draft"
  set view_count to 0
  respond with the created post

api UpdatePost:
  requires authentication
  accepts post_id, title, content, excerpt, category_id, tags, cover_image, and status
  fetch the Post by post_id
  if post does not exist, respond with "post not found"
  check that current user is the author or an admin
  update the Post with the given fields
  if status changes to "published", set published_at to now
  respond with the updated post

api DeletePost:
  requires authentication
  accepts post_id
  fetch the Post by post_id
  if post does not exist, respond with "post not found"
  check that current user is the author or an admin
  delete the Post
  respond with "post deleted"

api ListPosts:
  fetch all posts with status "published"
  sort by published_at descending
  support filtering by category
  support filtering by tag
  support searching by title or content
  paginate with 10 per page
  respond with posts and pagination info

api CreateComment:
  requires authentication
  accepts post_id, content, and optional parent_comment
  check that content is not empty
  check that content is less than 2000 characters
  fetch the Post by post_id
  if post does not exist, respond with "post not found"
  create a Comment with the given fields and current user
  respond with the created comment

api GetPost:
  accepts slug
  fetch the Post by slug
  if post does not exist, respond with "post not found"
  increment view_count
  respond with the post, author, comments, and tags

# ─────────────────────────────────────────────────────────────
── security ──
# ─────────────────────────────────────────────────────────────

authentication:
  method JWT tokens that expire in 14 days
  method Google OAuth with redirect to /auth/google/callback
  passwords are hashed with bcrypt using 12 rounds
  all api requests require a valid token except SignUp, Login, ListPosts, and GetPost
  rate limit all endpoints to 60 requests per minute per user
  sanitize all text inputs against XSS
  enable CORS only for our frontend domain

# ─────────────────────────────────────────────────────────────
── policies ──
# ─────────────────────────────────────────────────────────────

policy Reader:
  can view all published posts
  can create comments on published posts
  can edit only their own comments
  cannot create posts
  cannot access the dashboard

policy Author:
  can create posts
  can edit only their own posts
  can delete only their own posts
  can submit posts for review
  can view their own dashboard
  can manage their own comments

policy Admin:
  can view all users and their data
  can edit any post
  can delete any post
  can approve or reject posts in review
  can manage categories and tags
  can view site analytics

# ─────────────────────────────────────────────────────────────
── workflows ──
# ─────────────────────────────────────────────────────────────

when a user signs up:
  create their account
  assign Reader policy
  send welcome email with template "welcome-to-blog"

when a post is submitted for review:
  notify all admins via email
  after 48 hours, if still in review,
    send reminder email to admins

when a post is published:
  send notification to the author
  update the author's published post count
  log the publication for analytics

when a comment is created:
  notify the post author via email
  if it is a reply, also notify the parent comment author

# ─────────────────────────────────────────────────────────────
── logic ──
# ─────────────────────────────────────────────────────────────

if database is unreachable:
  retry 3 times with 1 second delay
  if still failing, respond with "service temporarily unavailable"
  alert the engineering team via Slack

if an api request fails validation:
  respond with a clear message explaining what is wrong
  log the attempt for analytics
  do not reveal internal details

# ─────────────────────────────────────────────────────────────
── database ──
# ─────────────────────────────────────────────────────────────

database:
  use PostgreSQL
  when the app starts, create tables if they don't exist
  index User by email
  index Post by slug
  index Post by user and status
  index Post by published_at
  index Comment by post
  index Tag by name
  backup daily at 2am
  keep backups for 30 days

# ─────────────────────────────────────────────────────────────
── integrations ──
# ─────────────────────────────────────────────────────────────

integrate with SendGrid:
  api key from environment variable SENDGRID_API_KEY
  use for sending transactional emails

integrate with Cloudinary:
  api key from environment variable CLOUDINARY_API_KEY
  secret from environment variable CLOUDINARY_SECRET
  use for storing post images and user avatars

integrate with Slack:
  api key from environment variable SLACK_WEBHOOK_URL
  use for team notifications and alerts

# ─────────────────────────────────────────────────────────────
── devops ──
# ─────────────────────────────────────────────────────────────

architecture: monolith

source control using Git on GitHub
repository: https://github.com/example/blog-platform

branches:
  main is the production branch
  staging is the pre-release branch
  feature branches from main with prefix "feat/"
  bugfix branches from main with prefix "fix/"

when code is pushed to a feature branch:
  run all tests
  check code formatting
  check for security vulnerabilities
  report results back to the pull request

when code is merged to main:
  run all tests
  build the application
  deploy to production environment
  run health checks
  if health checks fail, rollback automatically
  notify the team on Slack

environment staging:
  url is staging.blog.example.com
  uses staging database
  seeds with test data

environment production:
  url is blog.example.com
  uses production database
  requires manual approval for deployment
  has auto-scaling enabled

track response times for all api endpoints
track error rates per endpoint
track active users daily and monthly
alert on Slack if error rate exceeds 5 percent
alert on Slack if response time exceeds 2 seconds
log all api requests to CloudWatch
keep logs for 90 days

# ─────────────────────────────────────────────────────────────
── build ──
# ─────────────────────────────────────────────────────────────

build with:
  frontend using Vue with TypeScript
  backend using Python with FastAPI
  database using PostgreSQL
  deploy to Docker
